'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = getCallerFile;

var _detectNode = require('detect-node');

var _detectNode2 = _interopRequireDefault(_detectNode);

var _stackTrace = require('stack-trace');

var _stackTrace2 = _interopRequireDefault(_stackTrace);

var _fs = require('fs');

var _fs2 = _interopRequireDefault(_fs);

var _fsExtra = require('fs-extra');

var _fsExtra2 = _interopRequireDefault(_fsExtra);

var _stacktraceJs = require('stacktrace-js');

var _stacktraceJs2 = _interopRequireDefault(_stacktraceJs);

var _os = require('os');

var _os2 = _interopRequireDefault(_os);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var isWindows = _os2.default.platform() === 'win32';

var DEFAULT_INDEX = 1;

//
// Get callsite info for logging purposes.
// Used to log urls in terminal which will open the IDE with the file open.
//
// We use native Node.js functionality because it supports `source-map-support`.
//

function getCallerFile() {
  var index = arguments.length <= 0 || arguments[0] === undefined ? 0 : arguments[0];

  if (_detectNode2.default) {
    var err = new Error();
    var stack = _stackTrace2.default.parse(err);
    var line = stack[DEFAULT_INDEX + index];
    // TODO(vjpr): Handle the else case better. Check usages.
    var fileName = line.getFileName();
    var realpath = _fsExtra2.default.existsSync(fileName) ? _fsExtra2.default.realpathSync(fileName) : '';
    return {
      path: line.getFileName(),
      realpath: realpath,
      line: line.getLineNumber(),
      col: line.getColumnNumber()
    };
  } else {
    // TODO(vjpr): Implement for browser. stackinfo is buggy. Use stacktrace.js.
    //return stackinfo()[INDEX]
    var _stack = _stacktraceJs2.default.getSync();
    var _line = _stack[DEFAULT_INDEX + index];
    return {
      path: _line.getFileName(),
      line: _line.getLineNumber(),
      col: _line.getColumnNumber()
    };
  }
}
module.exports = exports['default'];
//# sourceMappingURL=get-caller-file.js.map
