global.__CLIENT__ = false
const {Live} = require('..')

describe('Live', function() {

  beforeEach(function() {
    this.beforeCb = sinon.spy()
    this.afterCb = sinon.spy()
    const self = this
    this.fooModule = {
      $name: 'foo',
      register: (live) => {
        live.before('start', async () => {
          self.beforeCb()
        })
        live.after('start', async () => {
          self.afterCb()
        })
      },
    }
  })

  it('simple register', function(done) {
    const self = this
    const live = new Live
    this.fooModule.register(live)
    live.start().then(function() {
      self.beforeCb.should.have.been.calledBefore(self.afterCb)
      done()
    })

  })

  it('register', function(done) {
    const self = this
    const live = new Live
    live.register(this.fooModule)
    live.start().then(function() {
      self.beforeCb.should.have.been.calledBefore(self.afterCb)
      done()
    })
  })

  //it('use global live instance', function() {
  //  const self = this
  //  const {Live} = require('..')
  //  live.register(this.fooModule)
  //  live.start().then(function() {
  //    self.beforeCb.should.have.been.calledBefore(self.afterCb)
  //    done()
  //  })
  //})

})
